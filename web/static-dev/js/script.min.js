const C=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerpolicy&&(t.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?t.credentials="include":a.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(a){if(a.ep)return;a.ep=!0;const t=o(a);fetch(a.href,t)}};C();var c={};const p=document.querySelector("#local-video");var l=new MediaStream;btnToggleAudio=document.querySelector("#btn-toggle-audio");btnToggleVideo=document.querySelector("#btn-toggle-video");var u=document.querySelector("#msg"),m=document.querySelector("#btn-send-msg"),g=document.querySelector("#message-list"),h=JSON.parse(document.getElementById("json-room_id").textContent),f="";window.location.protocol=="https:"?f="wss":f="ws";var M=`${f}://${window.location.host}/${f}/${h}/`,d,O=document.querySelector("#username"),s,L=document.querySelector("#btn-join");L.onclick=e=>{if(s=O.value,s=="")return alert("The Username can't be Null!");document.getElementById("complete-div").remove(),d=new WebSocket(M),d.onopen=function(n){v("new-peer",{local_screen_sharing:!1})},d.onmessage=E,d.onclose=function(n){},d.onerror=function(n){},m.disabled=!1,u.disabled=!1};function E(e){var n=JSON.parse(e.data),o=n.action,r=n.peer;if(r!=s){var a=n.message.receiver_channel_name;if(o=="new-peer"){N(r,a);return}if(o=="new-offer"){var t=n.message.sdp,i=V(t,r,a);return}if(o=="new-answer"){var i=null;i=c[r][0];var S=n.message.sdp;i.setRemoteDescription(S);return}}}u.addEventListener("keyup",function(e){e.keyCode==13&&(e.preventDefault(),m.click())});m.onclick=_;function _(){var e=u.value;if(e===""&&Swal.fire({icon:"error",title:"Oops ...",text:"Message Can't be Empty!"}),e!==""){var n=document.createElement("li");n.appendChild(document.createTextNode("Me: "+e)),g.appendChild(n);var o=q();for(index in o)o[index].send(s+": "+e);u.value=""}}const D={video:!0,audio:!0};userMedia=navigator.mediaDevices.getUserMedia(D).then(e=>{l=e,p.srcObject=l,p.muted=!0,window.stream=e,audioTracks=e.getAudioTracks(),videoTracks=e.getVideoTracks(),audioTracks[0].enabled=!0,videoTracks[0].enabled=!0,btnToggleAudio.onclick=function(){if(audioTracks[0].enabled=!audioTracks[0].enabled,audioTracks[0].enabled){btnToggleAudio.innerHTML='<i class="fas fa-microphone-slash"></i>';return}btnToggleAudio.innerHTML='<i class="fas fa-microphone"></i>'},btnToggleVideo.onclick=function(){if(videoTracks[0].enabled=!videoTracks[0].enabled,videoTracks[0].enabled){btnToggleVideo.innerHTML='<i class="fas fa-video-slash"></i>';return}btnToggleVideo.innerHTML='<i class="fas fa-video"></i>'}}).catch(e=>{console.error("Error accessing media devices.",e)});function v(e,n){d.send(JSON.stringify({peer:s,action:e,message:n,room_id:h}))}function N(e,n){var o=new RTCPeerConnection(null);y(o);var r=o.createDataChannel("channel");r.onopen=()=>{console.log("Connection opened.")};var a=null;return r.onmessage=b,a=T(e),k(o,a),c[e]=[o,r],o.oniceconnectionstatechange=()=>{var t=o.iceConnectionState;(t==="failed"||t==="disconnected"||t==="closed")&&(delete c[e],t!="closed"&&o.close(),w(a))},o.onicecandidate=t=>{t.candidate||v("new-offer",{sdp:o.localDescription,receiver_channel_name:n})},o.createOffer().then(t=>o.setLocalDescription(t)).then(function(t){}),o}function V(e,n,o){var r=new RTCPeerConnection(null);y(r);var a=T(n);return k(r,a),r.ondatachannel=t=>{r.dc=t.channel,r.dc.onmessage=b,r.dc.onopen=()=>{console.log("Connection opened.")},c[n]=[r,r.dc]},r.oniceconnectionstatechange=()=>{var t=r.iceConnectionState;(t==="failed"||t==="disconnected"||t==="closed")&&(delete c[n],t!="closed"&&r.close(),w(a))},r.onicecandidate=t=>{t.candidate||v("new-answer",{sdp:r.localDescription,receiver_channel_name:o})},r.setRemoteDescription(e).then(()=>r.createAnswer()).then(t=>r.setLocalDescription(t)).catch(t=>{console.log("Error creating answer for %s.",n),console.log(t)}),r}function b(e){var n=e.data,o=document.createElement("li");o.appendChild(document.createTextNode(n)),g.appendChild(o)}function q(){var e=[];for(peerUsername in c){var n=c[peerUsername][1];e.push(n)}return e}function T(e){var n=document.querySelector("#video-container"),o=document.createElement("video");o.id=e+"-video",o.autoplay=!0,o.playsinline=!0;var r=document.createElement("div");n.appendChild(r),r.appendChild(o);var a=document.createElement("p");return a.className="text-center text-xl text-gray-700 font-bold mb-2",r.appendChild(a),a.innerHTML=e,o}function k(e,n){var o=new MediaStream;n.srcObject=o,e.addEventListener("track",async r=>{o.addTrack(r.track,o)})}function y(e){l.getTracks().forEach(n=>{e.addTrack(n,l)})}function w(e){var n=e.parentNode;n.remove()}
